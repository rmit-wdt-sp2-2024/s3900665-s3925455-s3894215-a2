Database:
----------------------------------------------
rmit.australiaeast.cloudapp.azure.com
SQL Login
s3925455_a2
abc123
database:s3925455_a2
Encription Mandatory
Trust cert: True
Servergroup: default

-----------------------------------------------
Schema/ table
-----------------------------------------------


create table Customer
(
    CustomerID int not null,
    Name nvarchar(50) not null,
    Address nvarchar(50) null,
    City nvarchar(40) null,
    PostCode nvarchar(4) null,
	Mobile nvarchar(10) null,
    constraint PK_Customer primary key (CustomerID)
);

create table Login
(
    LoginID char(8) not null,
    CustomerID int not null,
    PasswordHash char(94) not null,
    constraint PK_Login primary key (LoginID),
    constraint FK_Login_Customer foreign key (CustomerID) references Customer (CustomerID),
    constraint CH_Login_LoginID check (len(LoginID) = 8),
    constraint CH_Login_PasswordHash check (len(PasswordHash) = 94)
);

create table Account
(
    AccountNumber int not null,
    AccountType char not null,
    CustomerID int not null,
    Balance money not null,
    constraint PK_Account primary key (AccountNumber),
    constraint FK_Account_Customer foreign key (CustomerID) references Customer (CustomerID),
    constraint CH_Account_AccountType check (AccountType in ('C', 'S')),
    constraint CH_Account_Balance check (Balance >= 0)
);




create table [Transaction]
(
    TransactionID int identity not null,
    TransactionType char not null,
    AccountNumber int not null,
    DestinationAccountNumber int null,
    Amount money not null,
    Comment nvarchar(30) null,
    TransactionTimeUtc datetime2 not null,
    constraint PK_Transaction primary key (TransactionID),
    constraint FK_Transaction_Account_AccountNumber
    foreign key (AccountNumber) references Account (AccountNumber),
    constraint FK_Transaction_Account_DestinationAccountNumber
    foreign key (DestinationAccountNumber) references Account (AccountNumber),
    constraint CH_Transaction_TransactionType check (TransactionType in ('D', 'W', 'T', 'S')),
    constraint CH_Transaction_Amount check (Amount > 0)
);


create table BillPay
(
BillPayID int not null,
AccountNumber int not null,
PayeeID int not null,
Amount money not null, 
ScheduleTimeUtc datetime2 not null,
Period int not null,
constraint PK_BillPayID primary key (BillPayID),
CONSTRAINT FK_AccountNumber FOREIGN KEY (AccountNumber) REFERENCES Accounts (AccountNumber), 
CONSTRAINT FK_PayeeID FOREIGN KEY (PayeeID) REFERENCES Payees(PayeeID),
constraint CH_Amount check (Amount >= 0),
constraint CH_Period check (Period >= 0)
);

Create table Payee
(
PayeeID int not null,
    Name nvarchar(50) not null,
    Address nvarchar(50) null,
    City nvarchar(40) null,,
    PostCode nvarchar(4) null,
	Mobile nvarchar(10) null,
constraint PK_Payee primary key (PayeeID)

);

----------------------------------------
Reset DB
----------------------------------------

EXEC sp_MSForEachTable 'DISABLE TRIGGER ALL ON ?'
GO
EXEC sp_MSForEachTable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL'
GO
EXEC sp_MSForEachTable 'SET QUOTED_IDENTIFIER ON; DELETE FROM ?'
GO
EXEC sp_MSForEachTable 'ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL'
GO
EXEC sp_MSForEachTable 'ENABLE TRIGGER ALL ON ?'
GO
